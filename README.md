# BoolSearch

## Инструкция по использованию:
1. Если data/processed пуста или данные были обновлены, необходимо исполнить команду  
> ./scripts/index.sh
2. Если data/index пуст или данные были обновлены, необходимо исполнить команду  
> ./scripts/make_dict.sh
3. Для запроса необходимо удостоверится, что условия предыдущих пунктов удовлетворены и выполнить команду  
> ./scripts/search.sh "**query**"  
> 
> запрос (**query**) имеет вид:  
> term1 & term2 & (term3 | term4) | term5  
> т.е. слова - части запроса могут быть сгруппированы в скобки, и должны быть разделены знаками '|', '&', которые соответственно означают "или", "и".

## Реализованная логика:

1. index.sh - разбиваем данные в протобуфе на файлы формата (заголовок - урл, содержимое - текст), токенизируем текст и записываем в data/processed
2. make_dict.sh - проходим по токенизированным файлам, хешируем токены и сопоставляем каждому токену уникальные хеши документов, в которых они были встречены. Также сохраняем соответствие хеш документа -> url документа. Полученные соответственно хеш таблицу и дерево сжимаем и сохраняем в data/index
3. search.sh - преобразуем запрос (переводим в нижний регистр), загружаем хеш таблицу и исполняем запрос (в лоб). Получаем набор хешей урлов, подгружаем docid -> url и выводим результат поиска.

## Сравнительный анализ:

Был использован алгоритм сжатия varbyte, сжимал хеш-таблицу:  
token -> [doc_id]  
Рамзер сериализированной таблицы до использования varbyte - 16982054 байт (использовал boost::archive::binary_archive)  
Размер после использования varbyte - 17952018 байт.  
Тем не менее время сериализации boost:archive - 0.737404 секунд, а varbyte - 0.606833 (выйгрыш по времени - около 20%, при большом словаре довольно важно).  
Таким образом, varbyte показывает хорошую скорость и эффективность для CPU (всегда читаем целое количество байт), тем не менее из-за большой гранулярности он проиграл по сжатию примерно на 5%.

Также используя varbyte мы выигрываем по времени загрузки во время поиска - 0.786762 varbyte против 0.808683 boost::archive.  